<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Font Awesome for icons -->
    <link href="../../layout/css/fontawesome/css/all.min.css" charset="UTF-8" type="text/css" rel="stylesheet" />


    <link rel="stylesheet" href="imixs-markdown.css">

    <!-- Your script loading order here -->
    <script src="../marked.min.js"></script>
    <script src="turndown.js"></script>
    <script src="turndown-plugin-gfm.js"></script>
    <script src="imixs-markdown-converter.js"></script>
    <script src="imixs-markdown-editor.js"></script>
</head>

<body>
    <h1>Markdown Editor Toggle System</h1>

    <div class="info-box">
        <p><strong>Toggle between modes:</strong> Switch between visual editor and source code view</p>
    </div>

    <!-- Editor Header with Toolbar -->
    <div class="editor-header">
        <span class="editor-title"></span>
        <div class="editor-toolbar">
            <div class="toolbar-icon active" onclick="switchToEditor()" id="editorToggle" title="WYSIWYG Editor">
                <i class="fas fa-edit"></i>
            </div>
            <div class="toolbar-icon" onclick="switchToSource()" id="sourceToggle" title="Markdown Source">
                <i class="fas fa-code"></i>
            </div>
            <div class="toolbar-separator"></div>
            <div class="toolbar-icon" onclick="saveContent()" title="Save Content">
                <i class="fas fa-save"></i>
            </div>
            <div class="toolbar-icon" onclick="clearContent()" title="Clear All">
                <i class="fas fa-trash"></i>
            </div>
        </div>
    </div>

    <!-- Editor Container -->
    <div class="editor-container">
        <!-- WYSIWYG Editor -->
        <div id="editorjs"></div>

        <!-- Markdown Source Textarea (Jakarta EE Faces compatible) -->
        <textarea data-id="markdown_data" placeholder="Enter your markdown here...">
# Sample Document

This is a **sample** document to demonstrate the toggle functionality.

## Features

* Toggle between WYSIWYG and source view
* Auto-sync between modes
* Jakarta EE Faces compatible

Try switching between the modes using the toggle buttons above.
        </textarea>
    </div>

    <script>
        // Current mode tracking
        let currentMode = 'editor'; // 'editor' or 'source'

        /**
         * Initialize the toggle system
         */
        function initializeToggleSystem() {
            // Wait for editor to be initialized
            if (typeof editor === 'undefined' || !editor) {
                setTimeout(initializeToggleSystem, 100);
                return;
            }

            // Load initial content into editor
            loadMarkdownToEditor();

            console.log('Toggle system initialized');
        }

        /**
         * Switch to WYSIWYG Editor mode
         */
        function switchToEditor() {
            if (currentMode === 'editor') return;

            // Sync content from textarea to editor first
            loadMarkdownToEditor();

            // Show editor, hide textarea
            document.getElementById('editorjs').style.display = 'block';
            document.querySelector('textarea[data-id="markdown_data"]').style.display = 'none';

            // Update toggle buttons
            document.getElementById('editorToggle').classList.add('active');
            document.getElementById('sourceToggle').classList.remove('active');

            currentMode = 'editor';
            console.log('Switched to Editor mode');
        }

        /**
         * Switch to Markdown Source mode
         */
        function switchToSource() {
            if (currentMode === 'source') return;

            // Sync content from editor to textarea first
            saveEditorToMarkdown();

            // Hide editor, show textarea
            document.getElementById('editorjs').style.display = 'none';
            document.querySelector('textarea[data-id="markdown_data"]').style.display = 'block';

            // Update toggle buttons
            document.getElementById('sourceToggle').classList.add('active');
            document.getElementById('editorToggle').classList.remove('active');

            currentMode = 'source';
            console.log('Switched to Source mode');
        }

        /**
         * Load markdown from textarea into editor
         */
        function loadMarkdownToEditor() {
            const textarea = document.querySelector('textarea[data-id="markdown_data"]');
            if (!textarea || !editor) return;

            const markdownText = textarea.value.trim();
            if (!markdownText) {
                editor.innerHTML = '<p>Start typing or switch to source mode...</p>';
                editor.style.color = '#999';
                return;
            }

            // Convert markdown to HTML using marked.js
            const htmlContent = marked.parse(markdownText);
            editor.innerHTML = htmlContent;
            editor.style.color = '#000';

            console.log('Content loaded from textarea to editor');
        }

        /**
         * Save editor content to textarea as markdown
         */
        function saveEditorToMarkdown() {
            if (!editor) return;

            const textarea = document.querySelector('textarea[data-id="markdown_data"]');
            if (!textarea) return;

            // Convert HTML back to markdown using Turndown.js
            const markdownText = ImixsMarkdownConverter.htmlToMarkdown(editor.innerHTML);
            textarea.value = markdownText;

            console.log('Content saved from editor to textarea');
        }

        /**
         * Save content (triggered by save button)
         */
        function saveContent() {
            if (currentMode === 'editor') {
                saveEditorToMarkdown();
            }
            // In source mode, content is already in textarea

            alert('Content saved successfully!');
            console.log('Content saved');
        }

        /**
         * Clear all content
         */
        function clearContent() {
            if (confirm('Are you sure you want to clear all content?')) {
                // Clear both editor and textarea
                if (editor) {
                    editor.innerHTML = '<p>Content cleared...</p>';
                    editor.style.color = '#999';
                }

                const textarea = document.querySelector('textarea[data-id="markdown_data"]');
                if (textarea) {
                    textarea.value = '';
                }

                console.log('All content cleared');
            }
        }

        /**
         * Auto-sync content when switching modes (optional enhancement)
         */
        function enableAutoSync() {
            // Sync when editor loses focus (if in editor mode)
            if (editor) {
                editor.addEventListener('blur', function () {
                    if (currentMode === 'editor') {
                        saveEditorToMarkdown();
                    }
                });
            }

            // Sync when textarea loses focus (if in source mode)
            const textarea = document.querySelector('textarea[data-id="markdown_data"]');
            if (textarea) {
                textarea.addEventListener('blur', function () {
                    if (currentMode === 'source') {
                        // Content is already in textarea, no sync needed
                        console.log('Textarea content updated');
                    }
                });
            }
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            // Wait a moment for all scripts to load
            setTimeout(() => {
                initializeToggleSystem();
                enableAutoSync();
            }, 200);
        });
    </script>
</body>

</html>