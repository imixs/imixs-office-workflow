<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html">

	<!-- Note: the document height can be adjusted with the ui:param 'height' -->

	<script type="text/javascript">
		/*<![CDATA[*/
			
			/* reqlace special characters in attachemnt url */
		$(document).ready(
				function() {
					$(".imixs-form-attachments .attachmentlink-iframe").each(
						function(index, element) {
							var attachmentName=$(this).text();
							if (attachmentName.endsWith('.pdf') || attachmentName.endsWith('.PDF')) {									
								$(this).click();
								return false;
							}
						});
				});


		function updateIframe(docurl) {
			//console.log(docurl);
			$("#document_preview_helper").hide();
			var iframe = document.getElementById('imixs_dms_iframe');
			iframe.src = docurl;
		}
		/*]]>*/
	</script>


	<ui:param name="dmsList" value="#{dmsController.getDmsListByWorkitem(workitem)}"></ui:param>
	<h2>#{message.documents}</h2>
	<div class="imixs-form-section imixs-form-attachments">
	
		<!-- **** DMS List ***** -->
		<c:forEach var="attachment" items="#{dmsList}">
			<!-- link -->
			<span class="typcn typcn-document" style="font-size: 1.5 .em"></span>
			<span id="hyperlink" style="margin-right: 16px;"> 
			<ui:param
					name="attach" value="#{attachment.item['name']}"></ui:param> 
			<a
				href="javascript:void(0);" class="attachmentlink-iframe"
				onclick="updateIframe('#{facesContext.externalContext.requestContextPath}/api/snapshot/#{workitem.uniqueID}/file/#{attachment.item['name.encoded']}')">#{attach}</a>

			</span>
		</c:forEach>

		<ui:fragment rendered="#{! empty dmsList}">
		
			<p id="document_preview_helper" ><span class="typcn typcn-info-large" style="font-size: 1.5 .em"></span>#{message.documents_select}</p>
			
			<iframe id="imixs_dms_iframe" src="" width="100%" height="#{empty height?800:height}px">
			
			
			
			</iframe>
		</ui:fragment>
		
	

		<h:panelGroup layout="block" rendered="#{empty dmsList}"
			 style="margin-bottom:30px;"><span class="typcn typcn-info-large" style="font-size: 1.5 .em"></span>#{message.documents_empty}</h:panelGroup>
	</div>


</ui:composition>