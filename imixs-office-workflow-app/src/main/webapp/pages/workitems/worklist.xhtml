<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/layout/template.xhtml">


	<f:metadata>
		<f:viewAction action="#{searchController.init()}" />
	</f:metadata>

	<ui:define name="content">
		<f:view>
			<h:form>
				<ui:param name="searchresult" value="#{viewHandler.getData(searchController)}"></ui:param>
				<!-- test if exactly one result entry? -->
				<ui:fragment rendered="#{searchresult.size() eq 1}">
						<ui:param name="firstWorkitem" value="#{searchresult.get(0)}" />
						<script>
							window.document.location.href = "#{facesContext.externalContext.requestContextPath}/pages/workitems/workitem.xhtml?id=#{firstWorkitem.item['$uniqueid']}";
						</script>
				</ui:fragment>
				<ui:fragment rendered="#{searchresult.size() ne 1}">
					<div class="imixs-view">
						<!-- *** Header **** -->
						<div class="imixs-header">
							<!-- *** Header **** -->
							<ui:include src="/pages/workitems/worklist_header.xhtml" />
						</div>
	
						<ui:param name="noresult"
							value="#{(empty searchresult) and (empty searchController.searchFilter.item['txtSearch'])}"></ui:param>
	
						<ui:fragment rendered="#{!noresult}">
							<h:panelGroup layout="block" class="imixs-body" id="worklist-body">
	
								<!-- display search result  -->
								<ui:repeat var="workitem" value="#{searchresult}">
									<ui:include src="worklist_viewentry.xhtml">
										<ui:param name="workitem" value="#{workitem}" />
									</ui:include>
								</ui:repeat>
	
	
								<!-- display empty search result  -->
								<h:panelGroup
									rendered="#{(empty searchresult) and (empty facesContext.maximumSeverity)}">
									<h2>#{message.empty_worklist}</h2>
								</h:panelGroup>
	
	
								<!-- display parsing error -->
								<h:panelGroup rendered="#{! empty facesContext.maximumSeverity}"
									styleClass="ui-widget">
									<div class="ui-state-error"
										style="padding: .7em; margin-bottom: .7em; border: none; xbackground: none;">
										<h3>
											<span class="typcn typcn-warning-outline"></span>
											#{message.search_error_title}
										</h3>
										<p>
											<h:messages globalOnly="true" />
										</p>
									</div>
								</h:panelGroup>
							</h:panelGroup>
	
	
							<div class="imixs-footer">
								<h:commandButton actionListener="#{viewHandler.back(searchController)}"
									disabled="#{searchController.pageIndex==0}" value="#{message.prev}">
								</h:commandButton>
								<h:commandButton actionListener="#{viewHandler.forward(searchController)}"
									disabled="#{searchController.endOfList}" value="#{message.next}">
								</h:commandButton>
							</div>
	
						</ui:fragment>
	
					</div>
				</ui:fragment>
			</h:form>
		</f:view>
		
		
		
		<script type="text/javascript">
			/*<![CDATA[*/
	
			$(document).ready(function() {
				// set navigation
				document.cookie = "imixs.office.navigation=/pages/workitems/worklist.jsf;path=#{facesContext.externalContext.requestContextPath}/";
				// auto focus
				focusSearchPhrase();
			});
			
			// ajax refresh...
			function updateSearchForm(data) {
				if (data.status === 'success') {
					imixsOfficeWorkflow.layoutAjaxEvent(data);
					// auto focus
					focusSearchPhrase();
				}
			}
			
			// set the focus on the search phrase after a ajax event
			function focusSearchPhrase() {
				var phrase = $("[data-id='input_phrase']").val();        
				$("[data-id='input_phrase']").focus().val('').val(phrase);
			}
			
			/*]]>*/
		</script>
	
	
	</ui:define>
</ui:composition>
