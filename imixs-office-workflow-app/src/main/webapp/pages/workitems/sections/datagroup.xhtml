<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:i="http://java.sun.com/jsf/composite/imixs"
	xmlns:marty="http://java.sun.com/jsf/composite/marty">



	<!-- preload view options -->
	<f:event type="preRenderComponent" listener="#{dataGroupController.setOptions(options)}" />

	<h:panelGroup styleClass="imixs-view imixs-search" layout="block" id="dataview_result_id">
		<ui:param name="searchResult" value="#{viewHandler.getData(dataGroupController)}" />
		<ui:param name="searchPage"
			value="#{(dataGroupController.getPageIndex()+1)}/#{(dataGroupController.getTotalPages())}" />
		<ui:param name="viewItemDefinitions" value="#{dataGroupController.getViewItemDefinitions()}" />
		<table class="imixsdatatable imixs-orderitems">
			<tr>
				<ui:repeat value="#{viewItemDefinitions}" var="columnDef">
					<th>#{columnDef.item['item.label']}</th>
				</ui:repeat>
			</tr>
			<ui:repeat value="#{searchResult}" var="record">
				<tr>
					<ui:repeat value="#{viewItemDefinitions}" var="columnDef">
						<td>
							<ui:fragment rendered="#{columnDef.item['item.type'] eq 'xs:anyURI'}">
								<h:link outcome="/pages/workitems/workitem.xhtml?faces-redirect=true"
									styleClass="imixs-viewentry-main-link">
									<h:outputText value="#{record.item[columnDef.item['item.name']]}" />
									<f:param name="id" value="#{record.item['$uniqueid']}" />
								</h:link>
							</ui:fragment>

							<ui:fragment rendered="#{columnDef.item['item.type'] eq 'xs:string'}">
								<h:outputText value="#{record.item[columnDef.item['item.name']]}" />
							</ui:fragment>

							<ui:fragment rendered="#{columnDef.item['item.type'] eq 'xs:date'}"
								styleClass="align-center">
								<h:outputText value="#{record.item[columnDef.item['item.name']]}">
									<f:convertDateTime timeZone="#{message.timeZone}" type="both"
										pattern="#{message.datePatternShort}" />
								</h:outputText>
							</ui:fragment>

							<ui:fragment rendered="#{columnDef.item['item.type'] eq 'xs:double'}"
								styleClass="align-right">
								<h:outputText value="#{record.item[columnDef.item['item.name']]}">
									<f:convertNumber minFractionDigits="2" locale="de" />
								</h:outputText>
							</ui:fragment>
							<ui:fragment rendered="#{columnDef.item['item.type'] eq 'xs:float'}"
								styleClass="align-right">
								<h:outputText value="#{record.item[columnDef.item['item.name']]}">
									<f:convertNumber minFractionDigits="2" locale="de" />
								</h:outputText>
							</ui:fragment>

							<ui:fragment rendered="#{columnDef.item['item.type'] eq 'xs:dateTime'}">
								<f:facet name="header">#{columnDef.item['item.label']}</f:facet>
								<h:outputText value="#{record.item[columnDef.item['item.name']]}">
									<f:convertDateTime timeZone="#{message.timeZone}" type="both"
										pattern="#{message.dateTimePatternShort}" />
								</h:outputText>
							</ui:fragment>
						</td>
					</ui:repeat>
				</tr>



			</ui:repeat>


		</table>

		<!-- navigation -->
		<div
			style="background-color: #f9f9f9; font-size:0.85rem; border-bottom: 1px solid var(--input-border);border-left: 1px solid var(--input-border);border-right: 1px solid var(--input-border); height: 30px; display: flex; justify-content: space-between; align-items: center;padding: 5px 10px;">
			<span style="display: flex; align-items: center;gap: 10px;">
				<h:commandLink title="Excel Export" rendered="false" actionListener="#{dataGroupController.export()}"
					onclick="handleSubmit(this)">
					<i class="fa-solid fa-file-csv"></i>
				</h:commandLink>
				<h:commandLink title="Excel Export" rendered="#{dataGroupController.hasPoiExport()}"
					actionListener="#{dataGroupController.export()}" onclick="handleSubmit(this)">
					<i class="fa-solid fa-file-excel"></i>
				</h:commandLink>
			</span>
			<span style="display: flex; align-items: center; gap: 10px;">
				<h:outputText value=" #{(dataGroupController.pageIndex+1)} / #{dataGroupController.totalPages}" />
				<h:commandLink value="" action="#{dataGroupController.back()}">
					<f:ajax render="dataview_result_id" onevent="updateDataView" />
					<i class="fa-solid fa-backward"
						style=" #{(dataGroupController.pageIndex == 0)?'opacity:0.5':''}"></i>
				</h:commandLink>
				<h:commandLink value="" action="#{dataGroupController.forward()}">
					<f:ajax render="dataview_result_id" onevent="updateDataView" />
					<i class="fa-solid fa-forward" style=" #{(dataGroupController.endOfList)?'opacity:0.5':''}"></i>
				</h:commandLink>
			</span>
		</div>
	</h:panelGroup>


	<script type="text/javascript">
		/*<![CDATA[*/
		function handleSubmit(event) {
			// remove ajax loader 1sec after trigger excel export
			setTimeout(function () {
				document.body.classList.remove('loading');
			}, 2000);
		}
		/*]]>*/
	</script>

</ui:composition>