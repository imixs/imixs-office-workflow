<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:i="http://java.sun.com/jsf/composite/imixs"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:marty="http://java.sun.com/jsf/composite/marty"
	template="/layout/template.xhtml">


	<!-- 
	  Organisation diagram for processes and spaces based on OrgChart
	  
	  See: https://github.com/dabeng/OrgChart
	
	 -->


	<ui:define name="scripts">
		<link
			href="#{facesContext.externalContext.requestContextPath}/layout/css/jquery.orgchart.css?build=#{app.application_build_timestamp}"
			type="text/css" rel="stylesheet" />

		<script type="text/javascript"
			src="#{facesContext.externalContext.requestContextPath}/js/jquery.orgchart.js"></script>
		<script type="text/javascript">
			/*<![CDATA[*/
				
			// compute data structure by OrganigramController			
			var datasource_processes=#{organigramController.processDatasource};
			var datasource_spaces = #{organigramController.spaceDatasource};
			var ocSpaces;
			var ocProcesses; 
			
			
			$(document).ready(function() {
				
				ocProcesses=$('#organigram-processes').orgchart({
					'data' : datasource_processes,
					'nodeContent' : 'title',
					'verticalLevel': 2
				});
				
				ocSpaces=$('#organigram-spaces').orgchart({
					'data' : datasource_spaces,
					'nodeContent' : 'title'
					//,'verticalLevel': 4
				});
				
				// on click event handler for space nodes and process nodes only
				ocSpaces.$chartContainer.on('click', '.node.space',toggleTeamlist);
				ocProcesses.$chartContainer.on('click', '.node.process',toggleTeamlist);
			});
			
			
			/*
			 * This method toggles the team list members of a node 
			 */
			function toggleTeamlist() {
				var $this = $(this);
				var id=$this.attr('id');
			    // show teamlist only for non-root nodes
			      
				     // get content element of selected node
				     contentNode=$(".content",$this);
				     // toggle team list
				      teamlist=$(contentNode).find('.teams');
				     if (teamlist && teamlist.length>0) {
				    	// clean team list if available
				    	$(teamlist).remove();
				     } else {
				        $(contentNode).append( buildTeamTable() );
				     }
			}
			
			/*
			 * Helper method to build a team table html template
			 */
			function buildTeamTable() {
				var html="<div class='teams'>";
				
				html=html+"<div class='members'><p class='lead'><strong>Manager</strong></p>";
				html=html+"<p>Hans</p>";
				html=html+"</div>";
				
				html=html+"<div class='members'><p class='lead'><strong>Team</strong></p>";
				html=html+"<p>John Denver</p>";
				html=html+"<p>Hans</p>";
				html=html+"<p>Sepp</p>";
				html=html+"</div>";
				
				html=html+"<div class='members'><p class='lead'><strong>Assitenz</strong></p>";
				html=html+"<p>Melman</p>";
				html=html+"</div>";
				
				
				
				html=html+"</div>"
				return html;
			}
			
			
			

			/*]]>*/
		</script>

		<link
			href="#{facesContext.externalContext.requestContextPath}/layout/css/office-theme-organigram.css?build=#{app.application_build_timestamp}"
			type="text/css" rel="stylesheet" />


	</ui:define>

	<ui:define name="content">
		<f:view>
			<h:form id="organisation_form_id">
				<div class="imixs-header">
					<h1 style="text-align: center;">Organisation</h1>
				</div>
				<div class="imixs-body organigram-container">
					<div>
						<div id="organigram-processes" style="border-right: 1px solid #eee;height:100%;"></div>
					</div>
					<div>
						<div id="organigram-spaces"  ></div>
					</div>
				</div>
			</h:form>
			
			<code>
			Todos: 
			
			default collapse
			
			export to pdf
			
			pan-zoom
			
			custom-template.html
			
			</code>
		</f:view>
	</ui:define>




</ui:composition>
